import java.util.ArrayList;
import java.util.concurrent.Semaphore;

class Barbeiro extends Thread {
	
	Semaphore semaforo = BarbeariaMain.semaforo;
	ArrayList<Cliente> oficiais = BarbeariaMain.oficiais;
	ArrayList<Cliente> sargentos = BarbeariaMain.sargentos;
	ArrayList<Cliente> cabos = BarbeariaMain.cabos;
	boolean ocupado = false;
	int contOficiais = 0;
	int contSargentos = 0;
	int contCabos = 0;
	int relogioEscovinha = 0;
	double filaSargTotal = 0;
	double filaCabosTotal = 0;
	double filaOficiaisTotal = 0;
	int contadorVezesRelatorio = 0;
	int terminou  = 0;
	
	
	Barbeiro(String nome) {
		super(nome);
	}
	
	public void coletaInfo(int tipo)
	{
		if(tipo == 1) contOficiais++;
		if(tipo == 2) contSargentos++;
		if(tipo == 3) contCabos++;
		
		System.out.println("\n\n --------------------------------------------------");
		System.out.println("Numero de oficiais atendidos: " + oficiais.size());
		System.out.println("Numero de sargentos atendidos: " + sargentos.size());
		System.out.println("Numero de cabos atendidos: " + cabos.size());
		
		System.out.println("total oficiais teste: " + contOficiais);
		System.out.println("total sargentos teste: " + contSargentos);
		System.out.println("total cabos teste: " + contCabos);
		System.out.println("\n\n --------------------------------------------------");
	}
	
	public void guardador(Cliente cliente)
	{
		if(this.relogioEscovinha + cliente.tempoCorte >= 3)
		{
			this.relogioEscovinha = (3 - cliente.tempoCorte) + this.relogioEscovinha;
			System.out.println("3 segundos se passaram, hora do relatÃ³rio do Tenente Escovinha: ");
			System.out.println("tamanho da fila de sargentos " + sargentos.size());
			filaSargTotal = filaSargTotal + sargentos.size();
			System.out.println("tamanho da fila de Oficiais " + oficiais.size());
			filaSargTotal = filaOficiaisTotal + oficiais.size();
			System.out.println("tamanho da fila de Cabos " + cabos.size());
			filaSargTotal = filaCabosTotal + cabos.size();
			
			contadorVezesRelatorio++;
		}
	}
	
	

	
	@Override
	public void run() {
		
		
		try {
			Cliente cliente;

			
			while(BarbeariaMain.tainha.isAlive() || BarbeariaMain.isNotEmpty()) {
				
				cliente = null;
				
				semaforo.acquire();
				
				if(BarbeariaMain.numBarbeiros == 3) {
					
					if(getName().equals("Zero")) {
						
						if(oficiais.size() > 0) {
							
							ocupado = true;
							System.out.println("rodei 1");
							coletaInfo(1);
							cliente = oficiais.remove(0);
							guardador(cliente);
							
							
							
							
						} else if(sargentos.size() > 0 && BarbeariaMain.dentinho.ocupado) {
							
							System.out.println("rodei 2");
							coletaInfo(2);
							cliente = sargentos.remove(0);
							guardador(cliente);
							
						} else if(cabos.size() > 0 && BarbeariaMain.otto.ocupado) {
							
							System.out.println("rodei 3");
							coletaInfo(3);
							cliente = cabos.remove(0);
							guardador(cliente);
							
						}
					
					}
					
					else if(getName().equals("Dentinho")) {
						
						if(sargentos.size() > 0) {

							ocupado = true;
							System.out.println("rodei 2");
							coletaInfo(2);
							cliente = sargentos.remove(0);
							
						} else if(oficiais.size() > 0 && BarbeariaMain.zero.ocupado) {
							
							System.out.println("rodei 1");
							coletaInfo(1);
							cliente = oficiais.remove(0);
							
						} else if(cabos.size() > 0 && BarbeariaMain.otto.ocupado) {
							
							System.out.println("rodei 3");
							coletaInfo(3);
							cliente = cabos.remove(0);
							
						}
						
					}
					
					else if(getName().equals("Otto")) {
						
						if(cabos.size() > 0) {

							ocupado = true;
							System.out.println("rodei 3");
							coletaInfo(3);
							cliente = cabos.remove(0);
							
						} else if(oficiais.size() > 0 && BarbeariaMain.zero.ocupado) {
							
							System.out.println("rodei 1");
							coletaInfo(1);
							cliente = oficiais.remove(0);
							
						} else if(sargentos.size() > 0 && BarbeariaMain.dentinho.ocupado) {
							
							System.out.println("rodei 2");
							coletaInfo(2);
							cliente = sargentos.remove(0);
							
						}
						
					}
					
				}
				
				else {
						
					if(oficiais.size() > 0) {
						
						System.out.println("rodei 1");
						coletaInfo(1);
						cliente = oficiais.remove(0);
						
					} else if(sargentos.size() > 0) {
						System.out.println("rodei 2");
						coletaInfo(2);
						cliente = sargentos.remove(0);
						
					} else if(cabos.size() > 0) {
						
						System.out.println("rodei 3");
						coletaInfo(3);
						cliente = cabos.remove(0);
						
					}
					
				}
				
				if(cliente == null) {
					
					semaforo.release();
					
				} else {
					
					System.out.println(getName()+" cortando "+cliente);
					semaforo.release();
					Thread.sleep(cliente.tempoCorte*1000);
					ocupado = false;
					
				}
				
			}
			
			System.out.println(getName()+" foi pra casa");
			
		} catch (Exception e) {
			System.out.println(getName());
			e.printStackTrace();
		}
	}
}